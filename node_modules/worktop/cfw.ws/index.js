const { connect:e } = require('worktop/ws');function t(t){return function(n,r){let s=e(n);if(s)return s;let{0:o,1:i}=new WebSocketPair,c={};function a(e){return t(n,r,{send:i.send.bind(i),close:i.close.bind(i),state:c,event:e})}async function l(e){try{await a(e)}finally{i.close()}}return i.accept(),i.addEventListener("close",l),i.addEventListener("message",a),i.addEventListener("error",l),new Response(null,{status:101,statusText:"Switching Protocols",webSocket:o})}}exports.listen=t;